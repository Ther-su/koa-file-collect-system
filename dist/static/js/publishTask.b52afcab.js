(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["publishTask"],{"013d":function(t,e,n){},1733:function(t,e,n){"use strict";n("9ed1")},8256:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tinymce-box"},[n("editor",{attrs:{init:t.init},model:{value:t.myValue,callback:function(e){t.myValue=e},expression:"myValue"}})],1)},r=[],i=(n("4d20"),n("6a61"),n("2e91")),s=n("1422"),o=n.n(s),c=n("c04f"),u=(n("34a6"),n("b406"),n("0581"),n("6412"),n("8770"),n("10f5"),n("d1c1"),n("b199")),l={components:{Editor:c["a"]},name:"tinymce",props:{value:{type:String,default:""},plugins:{type:[String,Array],default:"lists image media table wordcount"},toolbar:{type:[String,Array],default:"formatselect | bold italic forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | image | removeformat"}},data:function(){var t=this;return{worker:null,init:{language_url:"/tinymce/langs/zh_CN.js",language:"zh_CN",skin_url:"/tinymce/skins/ui/oxide",height:300,plugins:this.plugins,toolbar:this.toolbar,branding:!1,menubar:!1,images_upload_handler:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(n,a,r){var i,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new FormData,s=n.blob(),e.next=4,t.calculateHash(s);case 4:o=e.sent,i.append("file",s),i.append("hash",o),Object(u["j"])(i).then((function(t){var e=t.data;a(e.url)})).catch((function(t){r(t)}));case 8:case"end":return e.stop()}}),e)})));function n(t,n,a){return e.apply(this,arguments)}return n}()},myValue:this.value}},mounted:function(){o.a.init({})},methods:{calculateHash:function(t){var e=this;return new Promise((function(n){e.worker=new Worker("./hash.js"),e.worker.postMessage({uploadFile:t}),e.worker.onmessage=function(t){var e=t.data.hash;e&&n(e)}}))},clear:function(){this.myValue=""}},watch:{value:function(t){this.myValue=t},myValue:function(t){this.$emit("input",t)}}},d=l,f=(n("1733"),n("5d22")),m=Object(f["a"])(d,a,r,!1,null,null,null);e["a"]=m.exports},"982e":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n("b775");function r(t){return Object(a["a"])({url:"/grade/people",method:"get",params:{gradeId:t}})}},"9ed1":function(t,e,n){},b199:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"d",(function(){return s})),n.d(e,"e",(function(){return o})),n.d(e,"j",(function(){return c})),n.d(e,"i",(function(){return u})),n.d(e,"g",(function(){return l})),n.d(e,"h",(function(){return d})),n.d(e,"f",(function(){return f})),n.d(e,"k",(function(){return m})),n.d(e,"c",(function(){return k})),n.d(e,"b",(function(){return h}));var a=n("d211"),r=n("b775");function i(t){return Object(r["a"])({url:"/task/add",method:"post",data:t})}function s(t){return Object(r["a"])(Object(a["a"])({url:"/task/my",method:"get"},t))}function o(t){return Object(r["a"])(Object(a["a"])({url:"/task/published",method:"get"},t))}function c(t){return Object(r["a"])({url:"/task/pic",method:"post",data:t})}function u(t,e){return Object(r["a"])(Object(a["a"])({url:"/task/fileChunk",method:"post",data:t},e))}function l(t,e){return Object(r["a"])(Object(a["a"])({url:"/task/fileMerge",method:"post",data:t},e))}function d(t){return Object(r["a"])({url:"/task/presence",method:"post",data:t})}function f(t){return Object(r["a"])(Object(a["a"])({url:"/task/submitSituation",method:"get"},t))}function m(t){return Object(r["a"])({url:"/task/update",method:"put",data:t})}function k(t){return Object(r["a"])(Object(a["a"])({url:"/task/download",method:"get",responseType:"blob"},t))}function h(t){return Object(r["a"])({url:"/task/delete",method:"put",data:t})}},be61:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"publish-task-container"},[n("el-card",[n("el-form",{ref:"taskFormRef",attrs:{model:t.taskInfo,"status-icon":"",rules:t.taskFormRules,size:"medium "}},[n("el-form-item",{attrs:{prop:"taskName",label:"作业名称"}},[n("el-input",{model:{value:t.taskInfo.taskName,callback:function(e){t.$set(t.taskInfo,"taskName",e)},expression:"taskInfo.taskName"}})],1),n("el-form-item",{attrs:{prop:"taskContent",label:"作业内容"}},[n("tinymce",{ref:"editor",model:{value:t.taskInfo.taskContent,callback:function(e){t.$set(t.taskInfo,"taskContent",e)},expression:"taskInfo.taskContent"}})],1),n("el-form-item",{attrs:{prop:"checkedStudents",label:"需提交作业的同学"}},[n("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),n("div",{staticStyle:{margin:"15px 0"}}),n("el-checkbox-group",{on:{change:t.handleCheckedStudentsChange},model:{value:t.taskInfo.checkedStudents,callback:function(e){t.$set(t.taskInfo,"checkedStudents",e)},expression:"taskInfo.checkedStudents"}},t._l(t.studentList,(function(e){return n("el-checkbox",{key:e.id,attrs:{label:e.id}},[t._v(t._s(e.fullName))])})),1)],1),n("el-form-item",{attrs:{prop:"deadline",label:"截止时间"}},[n("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",align:"center","picker-options":t.pickerOptions},model:{value:t.taskInfo.deadline,callback:function(e){t.$set(t.taskInfo,"deadline",e)},expression:"taskInfo.deadline"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"info"},on:{click:t.resetForm}},[t._v("重置")]),n("el-button",{attrs:{type:"warning"},on:{click:t.save}},[t._v("暂存")]),n("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交")])],1)],1)],1)],1)},r=[],i=(n("957b"),n("6a61"),n("2e91")),s=n("61f7"),o=n("982e"),c=n("b199"),u=n("8256"),l={name:"publishTask",components:{tinymce:u["a"]},data:function(){return{disabled:!1,formDataList:[],isUploading:!1,picUrl:"/prod-api/task/pic",canSubmit:!1,checkAll:!1,isIndeterminate:!1,studentList:[],taskInfo:{taskName:"",taskContent:"",deadline:"",checkedStudents:[]},taskFormRules:{taskName:[{required:!0,message:"请输入作业名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 10 个字符",trigger:"blur"}],taskContent:[{required:!0,message:"请输入作业内容",trigger:"blur"}],checkedStudents:[{required:!0,message:"请选择需要提交作业的同学",trigger:"blur"},{validator:Object(s["a"])(s["b"],"请选择需要提交作业的同学"),trigger:"blur"}],deadline:[{required:!0,message:"请输入截止日期",trigger:"blur"},{validator:Object(s["a"])(s["c"],"选择的时间应晚于现在哦"),trigger:"blur"}]},pickerOptions:{shortcuts:[{text:"今天",onClick:function(t){t.$emit("pick",new Date)}},{text:"明天",onClick:function(t){var e=new Date;e.setTime(e.getTime()+864e5),t.$emit("pick",e)}},{text:"一周后",onClick:function(t){var e=new Date;e.setTime(e.getTime()+6048e5),t.$emit("pick",e)}}]}}},created:function(){var t=localStorage.getItem("task");t&&(this.taskInfo=JSON.parse()),this.getStudentsByGrade()},methods:{save:function(){localStorage.setItem("task",JSON.stringify(this.taskInfo))},resetForm:function(){localStorage.removeItem("task"),this.checkAll=!1,this.taskInfo={taskName:"",taskContent:"",deadline:"",checkedStudents:[]}},getStudentsByGrade:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["a"])();case 2:n=e.sent,a=n.data,t.studentList=a;case 5:case"end":return e.stop()}}),e)})))()},handleCheckAllChange:function(t){var e=this.studentList.map((function(t){return t.id}));this.taskInfo.checkedStudents=t?e:[],this.isIndeterminate=!1},handleCheckedStudentsChange:function(t){var e=t.length;this.checkAll=e===this.studentList.length,this.isIndeterminate=e>0&&e<this.studentList.length},handleSubmit:function(){var t=this,e=this;this.$refs.taskFormRef.validate((function(n){if(!n)return!1;var a=t.$loading({lock:!0,text:"提交中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});t.taskInfo.publishTime=new Date,Object(c["a"])(t.taskInfo).then((function(t){a.close(),e.$message({message:"提交成功",type:"success"})})).catch((function(t){console.log(t)}))}))}}},d=l,f=(n("d43d"),n("5d22")),m=Object(f["a"])(d,a,r,!1,null,"00969633",null);e["default"]=m.exports},d43d:function(t,e,n){"use strict";n("013d")}}]);