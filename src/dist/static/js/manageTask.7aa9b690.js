(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["manageTask"],{1733:function(t,e,n){"use strict";n("9ed1")},8256:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tinymce-box"},[n("editor",{attrs:{init:t.init},model:{value:t.myValue,callback:function(e){t.myValue=e},expression:"myValue"}})],1)},a=[],r=(n("4d20"),n("6a61"),n("2e91")),s=n("1422"),o=n.n(s),u=n("c04f"),l=(n("34a6"),n("b406"),n("0581"),n("6412"),n("8770"),n("10f5"),n("d1c1"),n("b199")),c={components:{Editor:u["a"]},name:"tinymce",props:{value:{type:String,default:""},plugins:{type:[String,Array],default:"lists image media table wordcount"},toolbar:{type:[String,Array],default:"formatselect | bold italic forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | image | removeformat"}},data:function(){var t=this;return{worker:null,init:{language_url:"/tinymce/langs/zh_CN.js",language:"zh_CN",skin_url:"/tinymce/skins/ui/oxide",height:300,plugins:this.plugins,toolbar:this.toolbar,branding:!1,menubar:!1,images_upload_handler:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(n,i,a){var r,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=new FormData,s=n.blob(),e.next=4,t.calculateHash(s);case 4:o=e.sent,r.append("file",s),r.append("hash",o),Object(l["j"])(r).then((function(t){var e=t.data;i(e.url)})).catch((function(t){a(t)}));case 8:case"end":return e.stop()}}),e)})));function n(t,n,i){return e.apply(this,arguments)}return n}()},myValue:this.value}},mounted:function(){o.a.init({})},methods:{calculateHash:function(t){var e=this;return new Promise((function(n){e.worker=new Worker("./hash.js"),e.worker.postMessage({uploadFile:t}),e.worker.onmessage=function(t){var e=t.data.hash;e&&n(e)}}))},clear:function(){this.myValue=""}},watch:{value:function(t){this.myValue=t},myValue:function(t){this.$emit("input",t)}}},d=c,m=(n("1733"),n("5d22")),f=Object(m["a"])(d,i,a,!1,null,null,null);e["a"]=f.exports},"982e":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("b775");function a(t){return Object(i["a"])({url:"/grade/people",method:"get",params:{gradeId:t}})}},"9ed1":function(t,e,n){},a6bf:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"manage-task-container"},[n("el-card",[n("el-table",{attrs:{data:t.publishedTasks,border:"",stripe:""}},[n("el-table-column",{attrs:{type:"index",label:"#"}}),n("el-table-column",{attrs:{label:"作业名称",prop:"taskName"}}),n("el-table-column",{attrs:{label:"截止日期",prop:"deadline"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateFormat")(e.row.deadline))+" ")]}}])}),n("el-table-column",{attrs:{label:"发布日期",prop:"publishTime"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateFormat")(e.row.publishTime))+" ")]}}])}),n("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(n){return t.showEditDialog(e.row)}}},[t._v("编辑")]),n("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(n){return t.deleteTask(e.row)}}},[t._v("删除")]),n("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-setting"},on:{click:function(n){return t.showSumbitSituationDialog(e.row)}}},[t._v("提交情况")])]}}])})],1),n("el-pagination",{attrs:{small:"",background:"",layout:"total, sizes, prev, pager, next","page-sizes":[3,5,8,10],"page-size":t.queryInfo.pageSize,"current-page":t.queryInfo.pageNum,total:t.count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),n("el-dialog",{attrs:{title:"修改作业",visible:t.editDialogVisible,width:"80%"},on:{"update:visible":function(e){t.editDialogVisible=e}}},[n("el-form",{ref:"editFormRef",attrs:{model:t.editForm,"status-icon":"",rules:t.editFormRules,size:"medium"}},[n("el-form-item",{attrs:{prop:"taskName",label:"作业名称"}},[n("el-input",{model:{value:t.editForm.taskName,callback:function(e){t.$set(t.editForm,"taskName",e)},expression:"editForm.taskName"}})],1),n("el-form-item",{attrs:{prop:"taskContent",label:"作业内容"}},[n("tinymce",{ref:"editor",model:{value:t.editForm.taskContent,callback:function(e){t.$set(t.editForm,"taskContent",e)},expression:"editForm.taskContent"}})],1),n("el-form-item",{attrs:{prop:"checkedStudents",label:"需提交作业的同学"}},[n("el-checkbox",{attrs:{indeterminate:t.isIndeterminate,border:""},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),n("div",{staticStyle:{margin:"15px 0"}}),n("el-checkbox-group",{on:{change:t.handleCheckedStudentsChange},model:{value:t.editForm.checkedStudents,callback:function(e){t.$set(t.editForm,"checkedStudents",e)},expression:"editForm.checkedStudents"}},t._l(t.studentList,(function(e){return n("el-checkbox",{key:e.id,attrs:{label:e.id,border:""}},[t._v(t._s(e.fullName))])})),1)],1),n("el-form-item",{attrs:{prop:"deadline",label:"截止时间"}},[n("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",align:"center","picker-options":t.pickerOptions},model:{value:t.editForm.deadline,callback:function(e){t.$set(t.editForm,"deadline",e)},expression:"editForm.deadline"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.editDialogVisible=!1}}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit(t.editForm)}}},[t._v("保存")])],1)],1),n("el-dialog",{attrs:{title:"提交情况",visible:t.submitSituationDialogVisible,width:"80%"},on:{"update:visible":function(e){t.submitSituationDialogVisible=e}}},[n("el-table",{attrs:{data:t.submitSituation,border:"",stripe:""}},[n("el-table-column",{attrs:{type:"index",label:"#"}}),n("el-table-column",{attrs:{label:"学号",prop:"studentNumber"}}),n("el-table-column",{attrs:{label:"用户名称",prop:"userName"}}),n("el-table-column",{attrs:{label:"姓名",prop:"fullName"}}),n("el-table-column",{attrs:{label:"性别",prop:"gender"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("genderFormat")(e.row.gender))+" ")]}}])}),n("el-table-column",{attrs:{label:"提交日期",prop:"deadline"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateFormat")(e.row.submitTime))+" ")]}}])}),n("el-table-column",{attrs:{label:"提交情况",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tag",{attrs:{type:"1"===e.row.status?"danger":"success"}},[t._v(" "+t._s("1"===e.row.status?"未提交":"已提交")+" ")])]}}])}),n("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"mini",type:"danger",disabled:"1"===e.row.status,icon:"el-icon-download"},on:{click:function(n){return t.downloadPersonalTask(e.row)}}},[t._v("下载作业")])]}}])})],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-input",{attrs:{size:"small",placeholder:"请输入作业命名规则",clearable:""},model:{value:t.namingRule,callback:function(e){t.namingRule=e},expression:"namingRule"}}),n("div",{staticStyle:{margin:"15px 0"}}),n("el-button",{attrs:{type:"success",size:"small"},on:{click:t.exportExcel}},[t._v("导出提交情况")]),n("el-button",{attrs:{type:"primary",size:"small",disabled:!t.submitSituation.some((function(t){return"2"===t.status}))},on:{click:t.packFiles}},[t._v("打包班级作业")])],1)],1)],1)},a=[],r=(n("3f4b"),n("4318"),n("957b"),n("4d20"),n("6a22"),n("2e4f"),n("2181"),n("02dd"),n("80cf"),n("659e"),n("e5ed"),n("6a61"),n("2e91")),s=n("31bf"),o=n.n(s),u=n("a1d6"),l=n.n(u),c=n("61f7"),d=n("982e"),m=n("b199"),f=n("8256"),b={name:"manageTask",components:{tinymce:f["a"]},data:function(){return{namingRule:"毛概作业2019级电子与信息学院${studentNumber}-${fullName}",publishedTasks:[],count:0,isIndeterminate:!1,checkAll:!1,studentList:[],editForm:{},editDialogVisible:!1,submitSituationDialogVisible:!1,submitSituation:[],queryInfo:{pageSize:3,pageNum:1},editFormRules:{taskName:[{required:!0,message:"请输入作业名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 10 个字符",trigger:"blur"}],taskContent:[{required:!0,message:"请输入作业内容",trigger:"blur"}],checkedStudents:[{validator:Object(c["a"])(c["b"],"请选择需要提交作业的同学"),trigger:"blur"}],deadline:[{required:!0,message:"请输入截止日期",trigger:"blur"},{validator:Object(c["a"])(c["c"],"选择的时间应晚于现在哦"),trigger:"blur"}]},pickerOptions:{shortcuts:[{text:"今天",onClick:function(t){t.$emit("pick",new Date)}},{text:"明天",onClick:function(t){var e=new Date;e.setTime(e.getTime()+864e5),t.$emit("pick",e)}},{text:"一周后",onClick:function(t){var e=new Date;e.setTime(e.getTime()+6048e5),t.$emit("pick",e)}}]}}},methods:{deleteTask:function(t){var e=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(m["b"])({taskId:t.id}).then((function(t){e.$message({type:"success",message:"删除成功!"})}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},exportExcel:function(){var t=this;Promise.all([n.e("chunk-b93a6898"),n.e("chunk-2125b98f")]).then(n.bind(null,"4bf8")).then((function(e){var n=["学号","用户名称","姓名","性别","提交日期","提交情况"],i=["studentNumber","userName","fullName","gender","submitTime","status"],a=t.formatJson(i);e.export_json_to_excel({header:n,data:a,filename:"提交情况"})}))},formatJson:function(t){var e=this;return this.submitSituation.map((function(n){return t.map((function(t){return"submitTime"===t?e.$options.filters.dateFormat(n[t]):"gender"===t?e.$options.filters.genderFormat(n[t]):"status"===t?e.$options.filters.statusFormat(n[t]):n[t]}))}))},downloadOneFile:function(t){return new Promise((function(e,n){Object(m["c"])({params:{taskId:t.taskId,userId:t.id}}).then((function(t){e(t)})).catch((function(t){n(t)}))}))},packFiles:function(){var t=this,e=new l.a,n=this.submitSituation.filter((function(t){return"2"===t.status}));Promise.all(n.map(function(){var n=Object(r["a"])(regeneratorRuntime.mark((function n(i){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.downloadOneFile(i);case 2:a=n.sent,r=t.handleNameingFile(i)+i.suffix,e.file(r,a,{binary:!0});case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())).then((function(){e.generateAsync({type:"blob"}).then((function(t){o.a.saveAs(t,"打包.zip")}))}))},downloadPersonalTask:function(t){var e=this.handleNameingFile(t)+t.suffix;Object(m["c"])({params:{taskId:t.taskId,userId:t.id}}).then((function(t){var n=t,i=window.URL.createObjectURL(new Blob([n])),a=document.createElement("a");a.href=i,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}))},handleNameingFile:function(t){for(var e=t.fullName,n=t.studentNumber,i={fullName:e,studentNumber:n},a={},r=this.namingRule?this.namingRule:"${studentNumber}-${fullName}",s=this.namingRule,o=null,u=/(?<=\$\{)(.*?)(?=\})/g,l=/\$\{[^{}]+?\}/g,c=r.match(u),d=r.match(l),m=0;m<c.length;m++)a[d[m]]=c[m];for(var f=0;f<c.length;f++)o=s.replace(d[f],i[a[d[f]]]),s=o;return o},handleSizeChange:function(t){this.queryInfo.pageSize=t,this.getPublishedTasks()},handleCurrentChange:function(t){this.queryInfo.pageNum=t,this.getPublishedTasks()},getPublishedTasks:function(){var t=this;Object(m["e"])({params:this.queryInfo}).then((function(e){var n=e.data;t.publishedTasks=n.taskList,t.count=n.count})).catch((function(t){console.log(t)}))},handleCheckAllChange:function(t){var e=this.studentList.map((function(t){return t.id}));this.editForm.checkedStudents=t?e:[],this.isIndeterminate=!1},handleCheckedStudentsChange:function(t){var e=t.length;this.checkAll=e===this.studentList.length,this.isIndeterminate=e>0&&e<this.studentList.length},handleSubmit:function(t){var e=this,n=t.submitterList,i=t.id,a=this;this.$refs.editFormRef.validate((function(t){if(!t)return!1;var r=e.$loading({lock:!0,text:"提交中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=n.map((function(t){return t.userId})),o=e.editForm.checkedStudents.filter((function(t){return!s.includes(t)})),u=s.filter((function(t){return!e.editForm.checkedStudents.includes(t)}));e.editForm.addSubmitters=o,e.editForm.delSubmitters=u,e.editForm.publishTime=new Date,e.editForm.taskId=i,Object(m["k"])(e.editForm).then((function(t){r.close(),a.$message({message:"更新成功",type:"success"}),a.getPublishedTasks()})).catch((function(t){console.log(t),r.close()}))}))},getStudentsByGrade:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(d["a"])();case 2:n=e.sent,i=n.data,t.studentList=i;case 5:case"end":return e.stop()}}),e)})))()},showEditDialog:function(t){this.editForm=t,this.$set(this.editForm,"checkedStudents",this.editForm.submitterList.map((function(t){return t.userId}))),this.checkAll=this.studentList.length===this.editForm.submitterList.length,this.isIndeterminate=this.editForm.submitterList.length>0&&!this.checkAll,this.editDialogVisible=!0},showSumbitSituationDialog:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(m["f"])({params:{taskId:t.id}});case 2:i=n.sent,a=i.data,e.submitSituation=a.submitSituation,e.submitSituationDialogVisible=!0;case 6:case"end":return n.stop()}}),n)})))()}},created:function(){this.getStudentsByGrade(),this.getPublishedTasks()}},h=b,p=n("5d22"),g=Object(p["a"])(h,i,a,!1,null,null,null);e["default"]=g.exports},b199:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return s})),n.d(e,"e",(function(){return o})),n.d(e,"j",(function(){return u})),n.d(e,"i",(function(){return l})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return d})),n.d(e,"f",(function(){return m})),n.d(e,"k",(function(){return f})),n.d(e,"c",(function(){return b})),n.d(e,"b",(function(){return h}));var i=n("d211"),a=n("b775");function r(t){return Object(a["a"])({url:"/task/add",method:"post",data:t})}function s(t){return Object(a["a"])(Object(i["a"])({url:"/task/my",method:"get"},t))}function o(t){return Object(a["a"])(Object(i["a"])({url:"/task/published",method:"get"},t))}function u(t){return Object(a["a"])({url:"/task/pic",method:"post",data:t})}function l(t,e){return Object(a["a"])(Object(i["a"])({url:"/task/fileChunk",method:"post",data:t},e))}function c(t,e){return Object(a["a"])(Object(i["a"])({url:"/task/fileMerge",method:"post",data:t},e))}function d(t){return Object(a["a"])({url:"/task/presence",method:"post",data:t})}function m(t){return Object(a["a"])(Object(i["a"])({url:"/task/submitSituation",method:"get"},t))}function f(t){return Object(a["a"])({url:"/task/update",method:"put",data:t})}function b(t){return Object(a["a"])(Object(i["a"])({url:"/task/download",method:"get",responseType:"blob"},t))}function h(t){return Object(a["a"])({url:"/task/delete",method:"put",data:t})}}}]);